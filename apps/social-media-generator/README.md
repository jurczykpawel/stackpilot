# Social Media Generator

Generate pixel-perfect social media graphics from HTML/CSS templates. One text, multiple formats (Instagram, Stories, YouTube). Brand-consistent output.

## Installation

```bash
./local/deploy.sh social-media-generator --ssh=vps --domain-type=caddy --domain=smg.example.com
```

## Requirements

- **RAM:** 2GB minimum, ~512MB-1GB runtime usage
- **Disk:** ~1GB (Docker image with Chromium + Python + deps) + ~200MB PostgreSQL
- **Database:** PostgreSQL 16 (bundled, installed automatically)

**This app will NOT work on servers with <2GB RAM!** Headless Chromium needs ~1GB RAM. The install script blocks installation when <1800MB RAM is detected.

## After Installation

Web panel and API are available immediately:
- **Panel:** `https://your-domain` — magic link authentication (email)
- **API docs:** `https://your-domain/docs` — Swagger/OpenAPI
- **Health:** `https://your-domain/health`

### First Steps

1. Configure SMTP in `/opt/stacks/social-media-generator/.env` (magic link auth requires email)
2. Open the panel and register an account — first user becomes admin
3. Add custom brands in `repo/brands/` (CSS custom properties)

## Output Formats

| Format | Resolution | Usage |
|--------|-----------|-------|
| **Post** | 1080x1080 | Instagram, Facebook, LinkedIn |
| **Story** | 1080x1920 | Instagram Stories, TikTok |
| **YouTube** | 1280x720 | YouTube thumbnails |

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `SECRET_KEY` | (generated) | Session signing key — auto-generated by install.sh |
| `DATABASE_URL` | (bundled) | PostgreSQL connection string |
| `BASE_URL` | `http://localhost:8000` | Public URL (set by install.sh) |
| `SMTP_HOST` | (empty) | SMTP server for magic link auth |
| `SMTP_PORT` | 587 | SMTP port |
| `SMTP_USER` | (empty) | SMTP username |
| `SMTP_PASS` | (empty) | SMTP password |
| `EMAIL_FROM` | (empty) | Sender email address |
| `CREDIT_PRODUCTS` | JSON | Product-to-credits mapping |

## Templates

4 built-in templates:
- **quote-card** — quotes with backgrounds
- **tip-card** — tips and advice
- **announcement** — announcements
- **ad-card** — advertisements

Custom templates: add HTML/CSS to `repo/templates/`.

## Brands

Branding via CSS custom properties (`--brand-accent`, `--brand-font`, etc.). Add a directory with a CSS file to `repo/brands/`.

## Usage

### CLI (on server)

```bash
docker exec -it social-media-generator-app-1 \
  python generate.py --brand example --template quote-card --text "Your text"
```

### API

```bash
curl -X POST https://your-domain/api/generate \
  -H "Content-Type: application/json" \
  -d '{"brand": "example", "template": "quote-card", "text": "Your text"}'
```

### With n8n

Social Media Generator integrates with n8n for automated graphics generation:
1. HTTP Request node → POST to API
2. Receive generated images (base64/URL)
3. Publish via Postiz or send by email

## Stack

```
app (build: Dockerfile)  →  FastAPI + Playwright/Chromium + Jinja2
db  (postgres:16-alpine) →  User and credit database
```

## Backup

```bash
# Database backup
ssh vps 'cd /opt/stacks/social-media-generator && docker compose exec db pg_dump -U smg smg > backup.sql'

# Custom brands and templates backup
ssh vps 'tar czf /tmp/smg-custom.tar.gz /opt/stacks/social-media-generator/repo/brands/ /opt/stacks/social-media-generator/repo/templates/'
```

## Limitations

- **Slow build** — first `docker compose build` takes 3-5 minutes (Playwright + Chromium)
- **RAM usage** — Container limit is 1024MB, sufficient for normal use on 2GB VPS
- **Magic link requires SMTP** — Without email configuration, login links are shown in console (dev mode)
